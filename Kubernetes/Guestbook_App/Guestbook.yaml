apiVersion: apps/v1
kind: Deployment
metadata:
  name: guestbookapp
  labels:
    version: gesamte_version
    tier: frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      tier: frontend
      app: guestbook_app
  template:
    metadata:
      labels:
        tier: frontend
        app: guestbook_app
    spec:
      serviceAccountName: serviceaccountgb # Serviceaccount Hinzugef체gt.
      containers:
      - name: guestbook 
        image: nginxinc/nginx-unprivileged # Non-Root Nginx image verwenden.
        ports:
        - containerPort: 8080  # Mit diesem Image muss der Container auf Port 8080 laufen anstatt 80.
        
        # Resource Requirements
        resources:
          requests:
            cpu: 0.25 
            memory: 500Mi
          limits:
            cpu: 0.5
            memory: 1Gi

        # Enviroment Variabeln hinzugef체gt
        env:
        - name: Guestbook
          value: Das ist die Guestbook version mit allen Auftr채gen in einem.
        - name: Status
          value: Die Enviroment Variable funktioniert 
        
        # Enviroment Variabel von Secret hinzuf체gen
        - name: Secret
          valueFrom:
            secretKeyRef:
              name: secret-guestbook
              key: SecretEnv

        # Alle Capabilities werden entfernt
        securityContext:
          runAsNonRoot: true
          capabilities:
            drop: ["ALL"]
  
        # ConfigMap wird gemounted
        volumeMounts:
        - name: html
          mountPath: /usr/share/nginx/html # Pfad musste angepasst werden
          readOnly: false

        
      # Configmap mounten    
      volumes:
      - name: html
        configMap:
          name: html-configmap
        